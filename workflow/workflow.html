<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Workflow | Cosigt documentation</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/cosigtdoc/assets/css/0.styles.3e9b6cb4.css" as="style"><link rel="preload" href="/cosigtdoc/assets/js/app.ea2c52ed.js" as="script"><link rel="preload" href="/cosigtdoc/assets/js/3.d0293945.js" as="script"><link rel="preload" href="/cosigtdoc/assets/js/2.bc6597f8.js" as="script"><link rel="preload" href="/cosigtdoc/assets/js/1.50924563.js" as="script"><link rel="preload" href="/cosigtdoc/assets/js/14.3e4a7b1f.js" as="script"><link rel="preload" href="/cosigtdoc/assets/js/41.4a66e0c6.js" as="script"><link rel="prefetch" href="/cosigtdoc/assets/js/10.cf03d8e5.js"><link rel="prefetch" href="/cosigtdoc/assets/js/11.8e68a12f.js"><link rel="prefetch" href="/cosigtdoc/assets/js/12.50592b84.js"><link rel="prefetch" href="/cosigtdoc/assets/js/13.374a5d22.js"><link rel="prefetch" href="/cosigtdoc/assets/js/15.da27eca8.js"><link rel="prefetch" href="/cosigtdoc/assets/js/18.fbf56f97.js"><link rel="prefetch" href="/cosigtdoc/assets/js/19.056f4829.js"><link rel="prefetch" href="/cosigtdoc/assets/js/20.65bea4bc.js"><link rel="prefetch" href="/cosigtdoc/assets/js/21.58f7b93d.js"><link rel="prefetch" href="/cosigtdoc/assets/js/22.71d7b881.js"><link rel="prefetch" href="/cosigtdoc/assets/js/23.91ce9f40.js"><link rel="prefetch" href="/cosigtdoc/assets/js/24.3a6270a5.js"><link rel="prefetch" href="/cosigtdoc/assets/js/25.3f12cfe1.js"><link rel="prefetch" href="/cosigtdoc/assets/js/26.8cb8c3ad.js"><link rel="prefetch" href="/cosigtdoc/assets/js/27.5dc334b8.js"><link rel="prefetch" href="/cosigtdoc/assets/js/28.3dd02697.js"><link rel="prefetch" href="/cosigtdoc/assets/js/29.296314f5.js"><link rel="prefetch" href="/cosigtdoc/assets/js/30.41b87e58.js"><link rel="prefetch" href="/cosigtdoc/assets/js/31.e72a3f75.js"><link rel="prefetch" href="/cosigtdoc/assets/js/32.42c91560.js"><link rel="prefetch" href="/cosigtdoc/assets/js/33.ac668601.js"><link rel="prefetch" href="/cosigtdoc/assets/js/34.0463d7d5.js"><link rel="prefetch" href="/cosigtdoc/assets/js/35.24faa46f.js"><link rel="prefetch" href="/cosigtdoc/assets/js/36.f7952011.js"><link rel="prefetch" href="/cosigtdoc/assets/js/37.3936cd98.js"><link rel="prefetch" href="/cosigtdoc/assets/js/38.39491dd7.js"><link rel="prefetch" href="/cosigtdoc/assets/js/39.fcf0b573.js"><link rel="prefetch" href="/cosigtdoc/assets/js/4.d4f0fa8b.js"><link rel="prefetch" href="/cosigtdoc/assets/js/40.75445b96.js"><link rel="prefetch" href="/cosigtdoc/assets/js/42.36ab31b3.js"><link rel="prefetch" href="/cosigtdoc/assets/js/43.b3673f5a.js"><link rel="prefetch" href="/cosigtdoc/assets/js/44.5de79b32.js"><link rel="prefetch" href="/cosigtdoc/assets/js/45.72b0a3d1.js"><link rel="prefetch" href="/cosigtdoc/assets/js/46.66c1744e.js"><link rel="prefetch" href="/cosigtdoc/assets/js/47.8c8ded00.js"><link rel="prefetch" href="/cosigtdoc/assets/js/48.6d3f1d90.js"><link rel="prefetch" href="/cosigtdoc/assets/js/49.d6f16c9e.js"><link rel="prefetch" href="/cosigtdoc/assets/js/5.80b2fab8.js"><link rel="prefetch" href="/cosigtdoc/assets/js/50.6d501467.js"><link rel="prefetch" href="/cosigtdoc/assets/js/51.928baf40.js"><link rel="prefetch" href="/cosigtdoc/assets/js/52.26d55b7a.js"><link rel="prefetch" href="/cosigtdoc/assets/js/53.f71c9efb.js"><link rel="prefetch" href="/cosigtdoc/assets/js/54.8a3f53e6.js"><link rel="prefetch" href="/cosigtdoc/assets/js/55.37f9a0c0.js"><link rel="prefetch" href="/cosigtdoc/assets/js/6.7b0da6a8.js"><link rel="prefetch" href="/cosigtdoc/assets/js/7.d7421304.js"><link rel="prefetch" href="/cosigtdoc/assets/js/8.d8702868.js"><link rel="prefetch" href="/cosigtdoc/assets/js/9.3f6bcb54.js"><link rel="prefetch" href="/cosigtdoc/assets/js/vendors~docsearch.d23114a2.js">
    <link rel="stylesheet" href="/cosigtdoc/assets/css/0.styles.3e9b6cb4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><!----> <header class="navbar"><div class="navbar-container"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/cosigtdoc/" class="home-link router-link-active"><!----> <span class="site-name">Cosigt documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" placeholder="Search" autocomplete="off" spellcheck="false" value=""> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="search-icon"><path d="M21.7,20.3L18,16.6c1.2-1.5,2-3.5,2-5.6c0-5-4-9-9-9c-5,0-9,4-9,9c0,5,4,9,9,9c2.1,0,4.1-0.7,5.6-2l3.7,3.7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3C22.1,21.3,22.1,20.7,21.7,20.3zM4,11c0-3.9,3.1-7,7-7c3.9,0,7,3.1,7,7c0,1.9-0.8,3.7-2,4.9c0,0,0,0,0,0s0,0,0,0c-1.3,1.3-3,2-4.9,2C7.1,18,4,14.9,4,11z"></path></svg> <span class="search-command-wrapper search-command"><span class="search-command-char">⌘</span> <span class="search-command-char">K</span></span> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/cosigtdoc/" class="vp-link nav-link">
  Home
  </a></div><div class="nav-item"><a href="/cosigtdoc/contact/contact.html" class="vp-link nav-link">
  Contact
  </a></div><div class="nav-item"><a href="https://github.com/davidebolo1993/cosigt" target="_blank" class="vp-link external nav-link">
  GitHub
  <!----> </a></div> <div class="VPNavBarAppearance appearance" data-v-19d27b0e><button type="button" aria-label="toggle dark mode" class="vt-switch vt-switch-appearance" data-v-19d27b0e><span class="vt-switch-check"><span class="vt-switch-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="vt-switch-appearance-sun"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path> <path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path> <path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path> <path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path> <path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path> <path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path> <path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path> <path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path> <path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="vt-switch-appearance-moon"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div> <!----></nav></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/cosigtdoc/" class="vp-link nav-link">
  Home
  </a></div><div class="nav-item"><a href="/cosigtdoc/contact/contact.html" class="vp-link nav-link">
  Contact
  </a></div><div class="nav-item"><a href="https://github.com/davidebolo1993/cosigt" target="_blank" class="vp-link external nav-link">
  GitHub
  <!----> </a></div> <div class="VPNavBarAppearance appearance" data-v-19d27b0e><button type="button" aria-label="toggle dark mode" class="vt-switch vt-switch-appearance" data-v-19d27b0e><span class="vt-switch-check"><span class="vt-switch-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="vt-switch-appearance-sun"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path> <path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path> <path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path> <path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path> <path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path> <path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path> <path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path> <path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path> <path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="vt-switch-appearance-moon"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></span></button></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/cosigtdoc/introduction/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/cosigtdoc/setup/setup.html" class="sidebar-link">Pipeline Setup</a></li><li><a href="/cosigtdoc/workflow/workflow.html" aria-current="page" class="active sidebar-link">Workflow</a></li><li><a href="/cosigtdoc/usecases/usecases.html" class="sidebar-link">Use Cases</a></li><li><a href="/cosigtdoc/contact/contact.html" class="sidebar-link">Contact</a></li></ul> </aside> <main class="page workflowworkflow.html"> <div class="theme-default-content vp-doc content__default"><h1 id="workflow"><a href="#workflow" class="header-anchor">#</a> Workflow</h1> <p>The <a href="https://snakemake.readthedocs.io/en/stable/executing/cli.html" target="_blank" rel="noopener noreferrer">rulegraph<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> below illustrates a compact representation of cosigt workflow:</p> <p><a href="./rulegraph.png"><img src="/cosigtdoc/assets/img/rulegraph.b89deed5.png" width="650" style="display:block;margin:0 auto;"></a></p> <p>This section outlines the core steps and logic behind the cosigt pipeline, which assigns structural haplotypes to sequenced samples by combining pangenome graph construction with cosine similarity-based classification. For each sample and region of interest, cosigt identifies the haplotype pair—selected from a given set of assemblies—that best explains the structural composition of that region.</p> <ol><li><a href="#graph-construction">Graph Construction</a>: builds a pangenome graph from haplotype blocks using pggb, enabling variant representation across samples.</li> <li><a href="#path-specific-node-coverage">Path Coverage Analysis</a>: calculates node traversal patterns for each haplotype, creating depth matrices that capture sequence variations.</li> <li><a href="#sample-specific-node-coverage">Sample Projection</a>: maps short-read data to the graph space, generating sample-specific coverage vectors.</li> <li><a href="#haplotype-deconvolution">Similarity Matching</a>: comparse sample vectors against all possible haplotype pairs using cosine similarity to identify optimal genotype matches.</li></ol> <h2 id="haplotypes-alignment"><a href="#haplotypes-alignment" class="header-anchor">#</a> Haplotypes alignment</h2> <p>The pipeline begins by aligning the assembled haplotypes (queries) to their corresponding reference genome (target) using <a href="https://github.com/lh3/minimap2" target="_blank" rel="noopener noreferrer">minimap2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. We use minimap2 with the <code>asm20</code> preset, as it is specifically optimized for assembly-to-reference alignment and permits continuous alignment across segments when the sequence divergence do not exceed 20%, even within complex regions.</p> <h2 id="target-region-liftover"><a href="#target-region-liftover" class="header-anchor">#</a> Target region liftover</h2> <p>Following the <a href="#haplotypes-alignment">initial alignment</a>, the workflow leverages an implicit pangenome graph model - implemented in the <a href="https://github.com/pangenome/impg" target="_blank" rel="noopener noreferrer">impg repository<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - to lift over coordinates of regions of interest from the target sequence to the queries. This step allows us to identify homologous <em>loci</em> across all haplotypes that map to a specified target region. The alignment coordinates are subsequently filtered and extended to ensure comprehensive coverage of the region of interest.</p> <h2 id="graph-construction"><a href="#graph-construction" class="header-anchor">#</a> Graph construction</h2> <p>With the coordinates of the target regions <a href="#target-region-liftover">established</a>, the pipeline extracts the corresponding sequences from both the target and the queries, then uses the pangenome graph builder <a href="https://github.com/pangenome/pggb" target="_blank" rel="noopener noreferrer">pggb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to construct a local pangenome graph. In <a href="https://www.nature.com/articles/s41586-024-07911-1" target="_blank" rel="noopener noreferrer">previous work<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, we found it beneficial to collapse regions with copy-number events into single regions of the graph. Therefore, the pipeline executes <code>pggb</code> with the <code>-c</code> parameter set to <code>2</code> by default, which enables us to build a graph that accurately represents variation in <em>loci</em> with high copy number variation.</p> <h2 id="structural-clustering"><a href="#structural-clustering" class="header-anchor">#</a> Structural clustering</h2> <p>We implemented a strategy within our pipeline to identify structural clusters in the extracted haplotypes. Using the <a href="#graph-construction">pggb graph</a>, we compute a <a href="https://en.wikipedia.org/wiki/Jaccard_index" target="_blank" rel="noopener noreferrer">jaccard<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>-based distance matrix between all haplotype pairs using <a href="https://github.com/pangenome/odgi" target="_blank" rel="noopener noreferrer">odgi<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <code>similarity</code> (score for each pairs ranges between <code>0</code> and <code>1</code>, with <code>0</code> = identical node traversal patterns; <code>1</code> = completely disjoint paths) and apply a clustering strategy based on <a href="https://en.wikipedia.org/wiki/DBSCAN" target="_blank" rel="noopener noreferrer">DBSCAN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (<code>minPoints</code> parameter is always set to <code>1</code>, while we dinamically compute the <code>eps</code>parameter of the algorithm). This approach allows us to group haplotypes by structural similarity, providing insights into the major structural variants present in the dataset.</p> <h2 id="path-specific-node-coverage"><a href="#path-specific-node-coverage" class="header-anchor">#</a> Path-specific node coverage</h2> <p>Our workflow uses <a href="https://github.com/pangenome/odgi" target="_blank" rel="noopener noreferrer">odgi<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <code>paths</code> to compute the coverage of each path over the nodes in the <a href="#graph-construction">graph</a>:</p> <ol><li>If a path crosses a certain node just once, its coverage over that node will be <code>1</code></li> <li>If a path does not cross a certain node, its coverage over that node will be <code>0</code></li> <li>If a path loops multiple times over a certain node, its coverage over that node will be <code>&gt;=2</code></li></ol> <p>The path coverage information is crucial for the subsequent <a href="#haplotype-deconvolution">haplotype deconvolution</a> step.</p> <h2 id="reads-to-assembly-alignment"><a href="#reads-to-assembly-alignment" class="header-anchor">#</a> Reads-to-assembly alignment</h2> <p>For each sample, short-reads spanning regions of interest are fetched from the initial alignment to the linear reference and mapped against the corresponding assembly blocks. This mapping is performed using the <a href="https://github.com/bwa-mem2/bwa-mem2" target="_blank" rel="noopener noreferrer">bwa-mem2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <code>mem</code> algorithm for modern genomes. For ancient genomes, we use <a href="https://github.com/lh3/bwa" target="_blank" rel="noopener noreferrer">bwa<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <code>aln</code> instead, with parameters optimized for ancient DNA as suggested in <a href="https://onlinelibrary.wiley.com/doi/10.1002/ece3.8297" target="_blank" rel="noopener noreferrer">this publication<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (<code>bwa aln -l 1024 -n 0.01 -o 2</code>). The pipeline retains alternative alignment hits to ensure comprehensive coverage of repetitive regions.</p> <h2 id="sample-specific-node-coverage"><a href="#sample-specific-node-coverage" class="header-anchor">#</a> Sample-specific node coverage</h2> <p>The <a href="#reads-to-assembly-alignment">alignments</a> generated in the previous step are projected onto the graph using <a href="https://github.com/AndreaGuarracino/gfainject" target="_blank" rel="noopener noreferrer">gfainject<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Read coverage over the graph nodes is then calculated using <a href="https://github.com/pangenome/gafpack.git" target="_blank" rel="noopener noreferrer">gafpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The pipeline incorporates the <code>--len-scale</code> parameter to normalize coverage based on node length and the <code>--weight-queries</code> parameter to account for multiple alignments of the same read, ensuring accurate representation of coverage in repetitive regions.</p> <h2 id="haplotype-deconvolution"><a href="#haplotype-deconvolution" class="header-anchor">#</a> Haplotype deconvolution</h2> <p>In the final step of the pipeline, the coverage vector of <a href="#sample-specific-node-coverage">each sample</a> is compared to a set of pre-computed haplotype coverage vectors. These haplotype vectors are generated by pairing all <a href="#path-specific-node-coverage">path</a> vectors over the graph. The comparison is performed using <a href="https://en.wikipedia.org/wiki/Cosine_similarity" target="_blank" rel="noopener noreferrer">cosine similarity<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which measures the similarity between two vectors as their dot product divided by the product of their lengths. The haplotype pair with the highest similarity to the short-read vector is assigned as the genotype for each sample in each genomic region. For haploid regions, the same principle applies, but the sample coverage vector is compared to each individual path coverage vector rather than pairs.</p> <h2 id="parallelization"><a href="#parallelization" class="header-anchor">#</a> Parallelization</h2> <p>The cosigt pipeline is designed to efficiently utilize available computational resources through extensive parallelization:</p> <ol><li>The <a href="#haplotypes-alignment">Assembly-to-Reference Alignment</a> runs in parallel for each chromosome and each assembly sample. The pipeline requires assembled contigs to follow the <a href="https://github.com/pangenome/PanSN-spec" target="_blank" rel="noopener noreferrer">PanSN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> specification (<code>sample#haplotype#contig</code>). All haplotypes sharing the same assembly sample identifier are aligned to their corresponding reference chromosome in a single process. For example, with contigs from 10 different assembly samples and regions from 2 different chromosomes, the workflow can spawn up to 20 concurrent processes during this alignment step.</li> <li>The <a href="#target-region-liftover">Target Region Liftover</a> process from target sequences to assembled haplotypes operates in parallel for each assembly sample and each region, further enhancing performance when processing diverse genomic regions.</li> <li>The different Graph Analysis operations run in parallel by region, including:
<ul><li><a href="#graph-construction">Graph construction from assembled contigs</a></li> <li><a href="#structural-clustering">Structural haplotype clustering</a></li> <li><a href="#path-specific-node-coverage">Computation of coverage along graph paths</a></li></ul></li> <li>The Sequencing Sample Processing stages of the pipeline are parallelized by both sequencing sample and region:
<ul><li><a href="#reads-to-assembly-alignment">Short-read alignment to assembled contigs</a></li> <li><a href="#sample-specific-node-coverage">Projection of short-read alignments into graph space</a></li> <li><a href="#haplotype-deconvolution">Haplotype deconvolution and genotyping of sequencing samples</a></li></ul></li></ol> <p>This multi-level parallelization strategy enables efficient processing of large cohorts with complex genomic regions, maximizing throughput on high-performance computing infrastructure.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><div class="inner"><a href="/cosigtdoc/setup/setup.html" class="vp-link prev"><span>←</span>
  Pipeline Setup
  <span><br> <span class="prev-link">/setup/setup.html</span></span></a> <a href="/cosigtdoc/usecases/usecases.html" class="vp-link next">
  Use Cases
  <span>
        →
        <br> <span class="next-link">/usecases/usecases.html</span></span></a></div></div> </main> <div class="sticker vuepress-toc"><div class="on-this-page">ON THIS PAGE</div> <div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#haplotypes-alignment" title="Haplotypes alignment">Haplotypes alignment</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#target-region-liftover" title="Target region liftover">Target region liftover</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#graph-construction" title="Graph construction">Graph construction</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#structural-clustering" title="Structural clustering">Structural clustering</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#path-specific-node-coverage" title="Path-specific node coverage">Path-specific node coverage</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#reads-to-assembly-alignment" title="Reads-to-assembly alignment">Reads-to-assembly alignment</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#sample-specific-node-coverage" title="Sample-specific node coverage">Sample-specific node coverage</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#haplotype-deconvolution" title="Haplotype deconvolution">Haplotype deconvolution</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#parallelization" title="Parallelization">Parallelization</a></div></div></div><div class="global-ui"></div></div>
    <script src="/cosigtdoc/assets/js/app.ea2c52ed.js" defer></script><script src="/cosigtdoc/assets/js/3.d0293945.js" defer></script><script src="/cosigtdoc/assets/js/2.bc6597f8.js" defer></script><script src="/cosigtdoc/assets/js/1.50924563.js" defer></script><script src="/cosigtdoc/assets/js/14.3e4a7b1f.js" defer></script><script src="/cosigtdoc/assets/js/41.4a66e0c6.js" defer></script>
  </body>
</html>
